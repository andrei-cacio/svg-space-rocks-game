<!DOCTYPE html>
<html>
<head>
	<title>SVG Fun</title>
</head>
<style>
	body {
		background-color: black;
		background-image: url(space-bg.jpeg);
	}
	rect {
		transition: all 10s ease-in-out;
	}

	circle {
		transition: all 1s ease-in-out;
	}

	#rocket.destroyed {
		animation: destroyAnimation 1s ease-in-out;
		animation-iteration-count: 3;
	}

	@keyframes destroyAnimation {
		0% { opacity: 1; }
		50% { opacity: 0;}
		100% { opacity: 1; }
	}

	#rocket{
		transition: none;
		transform: rotate(-45);
	}
	#rocket-surface {
		transform: matrix(1, -1, 1, 1, -31, 38);
	}
	#stage {
		background-color: #000;
		background-image: url(space-bg.jpeg);
	}

	#score {
		top: 15px;
		position: absolute;
		color: white;
		left: 15px;
	}

	#dev {
		position: absolute;
		top: 40px;
		left: 15px;
		color: green;
	}

	#dev.hide { display: none; }
	#dev.show { display: block; }
</style>
<body>
	<svg id="stage" width="700" height="700" onmousemove="moveRocket(evt)">
	</svg>
	<div id="score"></div>
	<div id="dev" class="show"></div>

	<svg id="rocket" width=30 height=100 xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 64 64" version="1.1">
<g id="rocket-surface">
<path style=" fill:#F6D397;" d="M 14.28125 42.949219 L 13.28125 43.261719 C 10.042969 44.214844 7.515625 46.757813 6.578125 50 C 5.949219 52.40625 5.585938 54.875 5.488281 57.359375 C 5.488281 57.914063 5.9375 58.359375 6.488281 58.359375 C 8.960938 58.265625 11.417969 57.902344 13.808594 57.28125 C 17.070313 56.34375 19.625 53.796875 20.570313 50.539063 L 20.898438 49.429688 "></path>
<path style=" fill:#FAEFDE;" d="M 15.429688 45.371094 L 14.949219 45.519531 C 13.441406 45.96875 12.265625 47.15625 11.828125 48.671875 C 11.535156 49.792969 11.363281 50.949219 11.320313 52.109375 C 11.3125 52.238281 11.363281 52.363281 11.453125 52.457031 C 11.546875 52.546875 11.671875 52.597656 11.800781 52.589844 C 12.953125 52.546875 14.101563 52.378906 15.21875 52.089844 C 16.746094 51.652344 17.9375 50.464844 18.378906 48.941406 L 18.539063 48.421875 "></path>
<path style=" fill:#F9E3AE;" d="M 25.28125 24.359375 L 9.828125 28.199219 C 9.019531 28.402344 8.292969 28.851563 7.75 29.488281 L 4.460938 33.351563 C 4.207031 33.648438 4.148438 34.0625 4.3125 34.417969 C 4.476563 34.773438 4.828125 35 5.21875 35 L 16 35 "></path>
<path style=" fill:#F9E3AE;" d="M 39.640625 38.71875 L 35.800781 54.179688 C 35.597656 54.992188 35.148438 55.71875 34.511719 56.261719 L 30.648438 59.539063 C 30.351563 59.792969 29.9375 59.851563 29.582031 59.6875 C 29.226563 59.523438 29 59.171875 29 58.78125 L 29 48 "></path>
<path style=" fill:#ACB7D0;" d="M 16.839844 37.308594 L 14.519531 41.578125 C 14.261719 42.3125 14.449219 43.125 15 43.671875 L 20.429688 49.101563 C 20.984375 49.628906 21.792969 49.796875 22.511719 49.53125 L 26.648438 47.351563 "></path>
<path style=" fill:#C2CDE7;" d="M 61.300781 5.078125 L 60.398438 11.21875 C 59.355469 18.371094 55.761719 24.90625 50.28125 29.621094 L 29.78125 47.25 C 28.988281 47.933594 27.800781 47.890625 27.058594 47.148438 L 17 37 C 16.257813 36.257813 16.214844 35.074219 16.898438 34.28125 L 34.5 13.820313 C 39.214844 8.34375 45.75 4.753906 52.898438 3.710938 L 59 2.808594 C 59.628906 2.707031 60.273438 2.910156 60.726563 3.359375 C 61.179688 3.808594 61.394531 4.449219 61.300781 5.078125 Z "></path>
<path style=" fill:#D5E0F3;" d="M 17 37.050781 C 16.257813 36.308594 16.214844 35.121094 16.898438 34.328125 L 34.5 13.820313 C 39.214844 8.34375 45.75 4.753906 52.898438 3.710938 L 21.230469 37 C 20.074219 38.175781 18.183594 38.199219 17 37.050781 Z "></path>
<path style=" fill:#ED7899;" d="M 61.300781 5.078125 L 60.398438 11.21875 C 59.898438 14.640625 58.808594 17.949219 57.179688 21 C 55.089844 18.910156 45.839844 10.160156 42.78125 7.101563 C 45.921875 5.375 49.351563 4.226563 52.898438 3.710938 L 59 2.808594 C 59.628906 2.707031 60.273438 2.910156 60.726563 3.359375 C 61.179688 3.808594 61.394531 4.449219 61.300781 5.078125 Z "></path>
<path style=" fill:#ACE3FF;" d="M 48 21 C 48 23.761719 45.761719 26 43 26 C 40.238281 26 38 23.761719 38 21 C 38 18.238281 40.238281 16 43 16 C 45.761719 16 48 18.238281 48 21 Z "></path>
<path style=" fill:#8D6C9F;" d="M 61.449219 2.671875 C 60.78125 1.996094 59.828125 1.683594 58.890625 1.820313 L 52.761719 2.71875 C 45.375 3.800781 38.628906 7.511719 33.761719 13.171875 L 24.929688 23.421875 L 9.578125 27.230469 C 8.574219 27.488281 7.671875 28.054688 7 28.851563 L 3.699219 32.699219 C 3.191406 33.292969 3.078125 34.128906 3.402344 34.835938 C 3.730469 35.546875 4.4375 36 5.21875 36 L 15.410156 36 C 15.457031 36.402344 15.585938 36.789063 15.789063 37.140625 L 13.628906 41.140625 C 13.601563 41.191406 13.578125 41.246094 13.558594 41.300781 C 13.464844 41.589844 13.414063 41.894531 13.410156 42.199219 L 12.960938 42.339844 C 9.402344 43.394531 6.628906 46.199219 5.621094 49.769531 C 4.96875 52.25 4.589844 54.789063 4.488281 57.351563 C 4.46875 57.894531 4.667969 58.421875 5.046875 58.816406 C 5.425781 59.207031 5.945313 59.429688 6.488281 59.429688 L 6.570313 59.429688 C 9.121094 59.328125 11.652344 58.953125 14.121094 58.308594 C 17.710938 57.273438 20.523438 54.476563 21.578125 50.890625 L 21.648438 50.660156 L 21.808594 50.660156 C 22.148438 50.65625 22.488281 50.597656 22.808594 50.488281 L 22.960938 50.429688 L 26.960938 48.328125 C 27.269531 48.511719 27.605469 48.636719 27.960938 48.699219 L 27.960938 58.78125 C 27.957031 59.5625 28.410156 60.273438 29.121094 60.601563 C 29.382813 60.722656 29.667969 60.789063 29.960938 60.789063 C 30.433594 60.789063 30.890625 60.617188 31.25 60.308594 L 35.148438 57 C 35.945313 56.324219 36.507813 55.414063 36.761719 54.398438 L 40.511719 39.320313 L 50.929688 30.320313 C 56.585938 25.453125 60.296875 18.703125 61.378906 11.320313 L 62.28125 5.179688 C 62.40625 4.261719 62.101563 3.332031 61.449219 2.671875 Z M 8.5 30.140625 C 8.902344 29.652344 9.449219 29.300781 10.058594 29.140625 L 22.671875 26 L 16.101563 33.679688 C 16.015625 33.78125 15.9375 33.886719 15.871094 34 L 5.21875 34 Z M 19.660156 50.289063 C 18.800781 53.214844 16.515625 55.496094 13.589844 56.351563 C 11.265625 56.949219 8.886719 57.300781 6.488281 57.398438 C 6.582031 54.992188 6.933594 52.601563 7.539063 50.269531 C 8.371094 47.359375 10.636719 45.074219 13.539063 44.21875 L 14.03125 44.070313 C 14.113281 44.179688 14.203125 44.28125 14.300781 44.378906 L 19.730469 49.808594 L 19.78125 49.808594 Z M 22.140625 48.601563 C 21.796875 48.722656 21.410156 48.644531 21.140625 48.398438 L 15.710938 43 C 15.441406 42.742188 15.335938 42.359375 15.441406 42 L 17.210938 38.75 L 25.378906 46.921875 Z M 34.828125 53.929688 C 34.667969 54.542969 34.320313 55.089844 33.828125 55.488281 L 30 58.78125 L 30 48.320313 C 30.152344 48.230469 30.296875 48.125 30.429688 48.011719 L 37.890625 41.589844 Z M 60.320313 4.929688 L 59.421875 11.058594 C 58.40625 17.972656 54.933594 24.285156 49.640625 28.839844 L 39.199219 37.839844 C 39.050781 37.914063 38.925781 38.023438 38.828125 38.160156 L 29.128906 46.5 C 28.734375 46.84375 28.140625 46.820313 27.769531 46.449219 L 17.671875 36.351563 C 17.304688 35.980469 17.285156 35.394531 17.621094 35 L 35.261719 14.480469 C 37.40625 11.984375 39.964844 9.875 42.820313 8.238281 L 47.289063 12.710938 C 47.6875 13.050781 48.277344 13.027344 48.648438 12.65625 C 49.015625 12.289063 49.039063 11.695313 48.699219 11.300781 L 44.699219 7.300781 C 47.320313 6.019531 50.117188 5.144531 53 4.699219 L 59.128906 3.800781 L 59.28125 3.800781 C 59.574219 3.796875 59.851563 3.921875 60.046875 4.144531 C 60.238281 4.363281 60.324219 4.660156 60.28125 4.949219 Z "></path>
<path style=" fill:#8D6C9F;" d="M 36 26.71875 C 35.601563 26.378906 35.011719 26.402344 34.640625 26.773438 C 34.273438 27.140625 34.25 27.734375 34.589844 28.128906 L 36 29.539063 C 36.398438 29.878906 36.988281 29.855469 37.359375 29.488281 C 37.726563 29.117188 37.75 28.527344 37.410156 28.128906 Z "></path>
<path style=" fill:#8D6C9F;" d="M 32.449219 30.25 C 32.058594 29.847656 31.414063 29.84375 31.015625 30.234375 C 30.613281 30.628906 30.609375 31.269531 31 31.671875 L 32.421875 33.078125 C 32.8125 33.46875 33.445313 33.46875 33.835938 33.074219 C 34.222656 32.683594 34.222656 32.050781 33.828125 31.660156 Z "></path>
<path style=" fill:#8D6C9F;" d="M 28.910156 33.789063 C 28.511719 33.449219 27.921875 33.472656 27.550781 33.84375 C 27.183594 34.210938 27.160156 34.804688 27.5 35.199219 L 28.910156 36.609375 C 29.308594 36.949219 29.898438 36.925781 30.265625 36.558594 C 30.636719 36.1875 30.660156 35.597656 30.320313 35.199219 Z "></path>
<path style=" fill:#8D6C9F;" d="M 25.378906 37.320313 C 24.976563 37.027344 24.421875 37.074219 24.074219 37.429688 C 23.726563 37.789063 23.695313 38.347656 24 38.738281 L 25.410156 40.148438 C 25.808594 40.488281 26.398438 40.46875 26.765625 40.097656 C 27.136719 39.726563 27.160156 39.136719 26.820313 38.738281 Z "></path>
<path style=" fill:#8D6C9F;" d="M 43 15 C 39.6875 15 37 17.6875 37 21 C 37 24.3125 39.6875 27 43 27 C 46.3125 27 49 24.3125 49 21 C 49 17.6875 46.3125 15 43 15 Z M 43 25 C 40.789063 25 39 23.210938 39 21 C 39 18.789063 40.789063 17 43 17 C 45.210938 17 47 18.789063 47 21 C 47 23.210938 45.210938 25 43 25 Z "></path>
<path style=" fill:#8D6C9F;" d="M 51.710938 14.289063 C 51.3125 13.949219 50.722656 13.972656 50.351563 14.34375 C 49.984375 14.710938 49.960938 15.304688 50.300781 15.699219 L 53.300781 18.699219 C 53.695313 19.039063 54.289063 19.015625 54.65625 18.648438 C 55.027344 18.277344 55.050781 17.6875 54.710938 17.289063 Z "></path>
</g>
</svg>

	<script>
		const CANVAS_SIZE = 700;
		const THRESHOLD = 200;
		const TRIGGER_SPEED = 100;
		const RENDER_SPEED = 1000;
		const ROCKET_WIDTH = 20;

		let space = [];
		let bullets = [];
		let rocksCreated = 0;
		let score = 0;
		let rocket;

		const getRandomPos = () => -Math.floor(Math.random() * THRESHOLD);
		const getRandomPosRange = (min, max) => Math.floor(Math.random() * (max - min + 1)) + min;

		const getRandomSize = () => Math.floor(Math.random() * 50);
		const getRandomHex = () => Math.round(0xffffff * Math.random()).toString(16);
		const svgns = "http://www.w3.org/2000/svg";
		const stage = document.getElementById('stage');	

		renderRocks(1000);
		infiniteLoop();
		addRocket();

		function addRocket(){
			const r = document.getElementById('rocket');
			r.setAttributeNS(null, 'x', 100);
			r.setAttributeNS(null, 'y', 600);
			document.body.removeChild(r);

			stage.appendChild(r);
			rocket = r;
		}

		function moveRocket(e) {
      		const x = e.clientX;
			rocket.setAttributeNS(null, 'x', x - 30);
  		}

		function breakRock(rock) {
			const width = parseInt(rock.getAttribute('width'));
			if(width > 10){
				const x = rock.getBoundingClientRect().x;
				const y = rock.getBoundingClientRect().y;

				const newWidth = Math.ceil(width / 2);

				const rock1 = renderItem(newWidth, x - 20, y + 20);
				const rock2 = renderItem(newWidth, x + 20, y - 20);

				run(rock1);
				run(rock2);
			}

			document.getElementById('stage').removeChild(rock);
		}

		const handleShoot = e => {
			if (e.target.tagName === 'rect') return;
			if (rocket.regenerating) return;
			
			const x = rocket.getBoundingClientRect().x + ROCKET_WIDTH/2;
			const y= rocket.getBoundingClientRect().y - ROCKET_WIDTH/2;
			shoot(attachBullet(x+10, y));
		}
		document.body.onclick = handleShoot;

		function attachBullet(x, y) {
			const item = document.createElementNS(svgns, 'circle');
			item.setAttributeNS(null, 'cx', x);
			item.setAttributeNS(null, 'cy', y);
			item.setAttributeNS(null, 'r', 5);
			item.setAttributeNS(null, 'fill', 'red');
			
			stage.appendChild(item);

			bullets.push(item);

			return item;
		}

		function cleanSpace() {
			const rocksInStage = [];
			space.forEach(rock => {
				if (rock.getBoundingClientRect().x > CANVAS_SIZE || rock.getBoundingClientRect().y > CANVAS_SIZE) {
					stage.removeChild(rock);
				} else {
					rocksInStage.push(rock);
				}
			});

			space = rocksInStage;
		}


		function cleanBullets() {
			const bulletsInStage = [];
			bullets.forEach(rock => {
				if (rock.getBoundingClientRect().x < -CANVAS_SIZE || rock.getBoundingClientRect().y < -CANVAS_SIZE) {
					stage.removeChild(rock);
				} else {
					bulletsInStage.push(rock);
				}
			});

			bullets = bulletsInStage;
		}

		function renderItem(sizeGiven, xGiven, yGiven) {
			const item = document.createElementNS(svgns, 'rect');

			if (xGiven && yGiven) {
				item.setAttributeNS(null, 'x', xGiven);
				item.setAttributeNS(null, 'y', yGiven);
			} else {
				item.setAttributeNS(null, 'x', getRandomPosRange(0, CANVAS_SIZE));
				item.setAttributeNS(null, 'y', getRandomPos());
			}
			
			
			const size = sizeGiven || getRandomSize();
			item.setAttributeNS(null, 'width', size);
			item.setAttributeNS(null, 'height', size);	
			item.setAttributeNS(null, 'stroke', `#${getRandomHex()}`);

			stage.appendChild(item);

			rocksCreated++;
			space.push(item);

			return item;
		}

		function renderRocks(nr = 0) {
			let idx = 0;
			function _render() {
				if (idx >= nr) return;

				setTimeout(() => {
					const item = renderItem();
					run(item);
					idx++;
					_render();
				}, RENDER_SPEED);
			}

			_render();
		}

		function shoot(bullet) {
			if (!bullet) return;
		
			const x = bullet.getBoundingClientRect().x;	
			const style = `
				transform: translateY(${x - 2000}px);
			`;

			bullet.setAttribute('style', style);
		}

		function run(item) {
			if (!item) return;

			const style = `
				transform: translate(${item.getAttribute('x')}px, ${CANVAS_SIZE + THRESHOLD}px);
			`
			setTimeout(() => {
				item
					.setAttribute('style', style);
			}, TRIGGER_SPEED);
		}

		function intersectRect(r1, r2) {
		    var r1 = r1.getBoundingClientRect();    //BOUNDING BOX OF THE FIRST OBJECT
		    var r2 = r2.getBoundingClientRect();    //BOUNDING BOX OF THE SECOND OBJECT
			
		    //CHECK IF THE TWO BOUNDING BOXES OVERLAP
		  return !(r2.left > r1.right || 
		           r2.right < r1.left || 
		           r2.top > r1.bottom ||
		           r2.bottom < r1.top);
		}

		function destroyBullet(bullet) {
			bullet.setAttributeNS(null, 'cx', -CANVAS_SIZE - 10);
			bullet.setAttributeNS(null, 'cy', -CANVAS_SIZE - 10);
			bullet.style = 'transition: none;'
		}

		function rocketHit() {
			score = 0;
			rocket.classList.add('destroyed');
			rocket.regenerating = true;
			setTimeout(() => {
				rocket.regenerating = false;
				rocket.classList.remove('destroyed');
			}, 3000);
		}

		function checkIfHit() {
			for (rock of space) {
				if (!rocket.regenerating && intersectRect(rocket, rock)) {
					rocketHit();
				}

				for (bullet of bullets) {
					if (intersectRect(bullet, rock)) {
						if (!rock.wasHit) {
							score++;
						}
						rock.wasHit = true;
						breakRock(rock);
						destroyBullet(bullet);
					}
				}
			}
		}

		function renderScore() {
			const scoreView = `${score} points`;

			if (document.getElementById('score').innerText !== scoreView) 
				document.getElementById('score').innerText = `${score} points`;
		}

		const D_KEY = 68;
		let isDevMode = true;
		function devMode() {
			const rocksCount = `${space.length} rocks`;
			const bulletsCount = `${bullets.length} bullets`;

			document.getElementById('dev').innerText = `${rocksCount} | ${bulletsCount}
			(press D to hide)`;
		}

		document.onkeyup = e => {
			if (e.keyCode === D_KEY) {
				if (isDevMode) {
					isDevMode = false;
					document.getElementById('dev').classList.remove('show');
					document.getElementById('dev').classList.add('hide');
				} else {
					document.getElementById('dev').classList.remove('hide');
					document.getElementById('dev').classList.add('show');
					isDevMode = true;
				}
			}
		};

		function infiniteLoop(){
			setInterval(() => {

				if (isDevMode) {
					devMode();
				}

				cleanSpace();
				cleanBullets();

				renderScore();

				checkIfHit();
			}, 10);
		} 

	</script>
</body>
</html>